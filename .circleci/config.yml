
version: 2
jobs:
  build:
    docker:
      - image: circleci/node:4

    working_directory: ~/repo

    steps:
      - checkout

      - run:
          name: install json-spec
          command: |
            cd json-spec
            npm install
      
      - run:
          name: install api-spec
          command: |
            cd api-spec
            npm install

      - run:
          name: validate api-spec
          command: |
            cd api-spec
            npm run generate-all
            git diff-index HEAD --
            if git diff-index HEAD -- | grep -q -e yaml; then echo "the main yaml files are not auto-generated"; exit 1; fi

      - run:
          name: validate json-spec
          command: |
            cd json-spec
            echo 'doing nothing'
            # node_modules/.bin/ajv validate -s json-schema/stac-item.json -r json-schema/geojson.json -d sample.json --verbose
            # node_modules/.bin/ajv validate -s json-schema/stac-item.json -r json-schema/geojson.json -d examples/landsat8-sample.json --verbose
